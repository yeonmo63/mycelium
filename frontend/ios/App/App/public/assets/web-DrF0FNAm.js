import{W as w,C as f,H as g,a as B}from"./index-BKmM41Na.js";class y extends w{async stopAndHideScanner(){console.log(window.OSBarcodeWebScanner),window.OSBarcodeWebScanner&&(await window.OSBarcodeWebScanner.stop(),window.OSBarcodeWebScanner=null),document.getElementById("cap-os-barcode-scanner-container-dialog").style.display="none"}buildScannerElement(){if(document.getElementById("cap-os-barcode-scanner-container")){document.getElementById("cap-os-barcode-scanner-container").className="scanner-container-display";return}const e=document.body.appendChild(document.createElement("div"));e.id="cap-os-barcode-scanner-container";const o=document.createElement("div");o.id="cap-os-barcode-scanner-container-dialog",o.className="scanner-dialog";const a=document.createElement("div");a.className="scanner-dialog-inner";const c=document.createElement("span");c.id="cap-os-barcode-scanner-close-button",c.className="close-button",c.innerHTML="&times;",a.appendChild(c);const r=document.createElement("p");r.innerHTML="&nbsp;",a.appendChild(r);const n=document.createElement("div");n.className="scanner-container-full-width",n.id="cap-os-barcode-scanner-container-scanner",a.appendChild(n),o.appendChild(a),e.appendChild(o)}async scanBarcode(e){return this.buildScannerElement(),document.getElementById("cap-os-barcode-scanner-container-dialog").style.display="block",new Promise((o,a)=>{var c,r;const n={facingMode:e.cameraDirection===1?"environment":"user",scanButton:e.scanButton===void 0?!1:e.scanButton,scanInstructions:e.scanInstructions?e.scanInstructions:"",orientation:e.scanOrientation?e.scanOrientation:f.PORTRAIT,showCameraSelection:!((c=e.web)===null||c===void 0)&&c.showCameraSelection?e.web.showCameraSelection:!1,typeHint:e.hint===17?void 0:e.hint,scannerFPS:!((r=e.web)===null||r===void 0)&&r.scannerFPS?e.web.scannerFPS:50};let l=!1;const u=document.getElementById("cap-os-barcode-scanner-close-button");u&&(u.onclick=async()=>{l||(l=!0,await this.stopAndHideScanner(),a(new Error("Couldnâ€™t scan because the process was cancelled.")))});const i=document.getElementById("cap-os-barcode-scanner-container-scanner");if(!i)throw new Error("Scanner Element is required for web");window.OSBarcodeWebScanner=new g(i.id,{formatsToSupport:n.typeHint!==void 0?[n.typeHint]:void 0,verbose:void 0});const b={fps:n.scannerFPS,qrbox:i.getBoundingClientRect().width*(9/16)-10,aspectRatio:16/9,videoConstraints:{focusMode:"continuous",height:{min:576,ideal:1920},deviceId:void 0,facingMode:n.facingMode}},p=(t,m)=>{var d,s;this.stopAndHideScanner(),o({ScanResult:t,format:(s=(d=m.result.format)===null||d===void 0?void 0:d.format)!==null&&s!==void 0?s:B.ALL})},S=t=>{["NotFoundException","No barcode or QR code detected","No MultiFormat Readers were able to detect the code"].find(d=>t.indexOf(d)!==-1)||(this.stopAndHideScanner(),console.error(`[Scanner Web Error] ${t}`),a(t))};window.OSBarcodeWebScanner.start({facingMode:n.facingMode},b,p,S)})}}export{y as CapacitorBarcodeScannerWeb};
